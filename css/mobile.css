/**
 * Mobile Optimization Styles
 * Responsive design for mobile and tablet devices
 */

/* ==========================================================================
   Mobile-First Base Styles
   ========================================================================== */

/* Prevent text size adjustment on orientation change */
html {
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  -ms-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

/* Smooth scrolling on mobile */
html {
  scroll-behavior: smooth;
}

/* Better font rendering on mobile */
body {
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* Prevent horizontal overflow on mobile */
@media (max-width: 768px) {
  html, body {
    overflow-x: hidden;
    width: 100%;
    max-width: 100%;
    background-color: #ffffff;
    color: #212529;
  }

  /* Ensure all text is readable on mobile */
  * {
    color: inherit;
  }

  h1, h2, h3, h4, h5, h6 {
    color: #212529;
  }

  p, div, span, td, th {
    color: #212529;
  }

  a {
    color: #0d6efd;
  }
}

/* ==========================================================================
   Touch Optimizations
   ========================================================================== */

/* Larger tap targets on mobile - using media query for reliability */
@media (max-width: 768px) {
  button,
  .btn,
  a.btn,
  [role="button"] {
    min-height: 48px !important;
    min-width: 48px !important;
    padding: 12px 20px !important;
    font-size: 1rem !important;
  }

  /* Even larger for primary actions */
  .btn-primary,
  .btn-close {
    min-height: 48px !important;
    min-width: 48px !important;
  }

  .btn-close {
    padding: 12px !important;
    font-size: 1.5rem !important;
  }
}

/* Additional class-based targeting for JS-detected mobile */
.is-mobile button,
.is-mobile .btn,
.is-mobile a.btn,
.is-mobile [role="button"] {
  min-height: 48px;
  min-width: 48px;
  padding: 12px 20px;
  font-size: 1rem;
}

/* Remove tap highlight on mobile */
.is-mobile * {
  -webkit-tap-highlight-color: transparent;
}

/* Custom tap highlight for interactive elements */
.is-mobile button:active,
.is-mobile .btn:active,
.is-mobile a:active,
.is-mobile [role="button"]:active {
  background-color: rgba(0, 0, 0, 0.05);
}

/* Improve touch scrolling */
.modal-body,
.table-responsive {
  -webkit-overflow-scrolling: touch;
}

/* ==========================================================================
   Map Responsive Styles
   ========================================================================== */

/* Map container adjustments for mobile */
@media (max-width: 768px) {
  .map-container {
    margin: 0 auto;
    padding: 10px;
    max-width: 100%;
    width: 100%;
    height: auto;
    overflow: visible;
    box-sizing: border-box;
  }

  .map-container svg {
    width: 100% !important;
    height: auto !important;
    max-height: none !important;
    max-width: 100% !important;
    display: block !important;
    margin: 0 auto !important;
  }

  /* Override any inline styles on mobile */
  body.is-mobile .map-container {
    max-width: 100% !important;
    padding: 10px !important;
    height: auto !important;
  }

  body.is-mobile .map-container svg {
    max-width: 100% !important;
    width: 100% !important;
  }

  /* Larger touch targets for map paths */
  .map-container path {
    stroke-width: 3 !important;
    cursor: pointer;
    stroke-opacity: 0.8;
  }

  /* Enhanced tap feedback */
  .map-container path:active {
    fill: rgba(52, 152, 219, 0.5) !important;
  }

  /* Ensure map paths are easily tappable */
  .map-container path:hover {
    fill: rgba(52, 152, 219, 0.3) !important;
  }
}

/* ==========================================================================
   Modal Responsive Styles
   ========================================================================== */

/* Full-screen modals on mobile */
@media (max-width: 576px) {
  .modal-dialog {
    margin: 0;
    max-width: 100%;
    height: 100%;
  }

  .modal-content {
    height: 100%;
    border: 0;
    border-radius: 0;
    background-color: #ffffff !important;
    color: #212529 !important;
  }

  .modal-body {
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 1rem;
    background-color: #ffffff !important;
    color: #212529 !important;
  }

  .modal-header {
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
    background-color: #ffffff !important;
    color: #212529 !important;
  }

  .modal-title {
    color: #212529 !important;
  }

  /* Larger close button on mobile */
  .modal .btn-close {
    width: 44px;
    height: 44px;
    padding: 0;
    margin: 0;
    opacity: 1;
  }

  /* Ensure text in modals is readable */
  .modal h1, .modal h2, .modal h3, .modal h4, .modal h5, .modal h6 {
    color: #212529 !important;
  }

  .modal p, .modal div, .modal span {
    color: #212529 !important;
  }

  /* Table text in modals */
  .modal .table {
    color: #212529 !important;
    background-color: #ffffff !important;
  }

  .modal .table th,
  .modal .table td {
    color: #212529 !important;
    background-color: transparent !important;
  }

  .modal .table-striped tbody tr:nth-of-type(odd) {
    background-color: rgba(0, 0, 0, 0.05) !important;
  }

  .modal .table-light {
    background-color: #f8f9fa !important;
    color: #212529 !important;
  }

  /* Links in modals */
  .modal a {
    color: #0d6efd !important;
  }

  .modal a:hover {
    color: #0a58ca !important;
  }

  /* Buttons in modals */
  .modal .btn-primary {
    color: #ffffff !important;
    background-color: #0d6efd !important;
    border-color: #0d6efd !important;
    transition: transform 200ms cubic-bezier(0.22, 1, 0.36, 1),
                box-shadow 220ms ease,
                background-color 220ms ease,
                border-color 220ms ease;
    will-change: transform, box-shadow;
  }

  .modal .btn {
    display: inline-block !important;
    min-height: 48px !important;
  }

  /* Fix button text visibility */
  .modal a.btn-primary {
    color: #ffffff !important;
  }

  .modal .btn-primary:hover,
  .modal .btn-primary:focus-visible {
    transform: translateY(-3px);
    box-shadow: 0 16px 34px rgba(13, 110, 253, 0.28);
  }

  .modal .btn-primary:active {
    transform: translateY(-1px);
    box-shadow: 0 10px 20px rgba(13, 110, 253, 0.24);
  }
}

/* Tablet adjustments */
@media (min-width: 577px) and (max-width: 768px) {
  .modal-dialog {
    max-width: 90%;
  }

  /* Ensure readability on tablet too */
  .modal-content {
    background-color: #ffffff !important;
    color: #212529 !important;
  }

  .modal-title,
  .modal-body,
  .modal-header {
    color: #212529 !important;
  }

  .modal .table {
    color: #212529 !important;
  }
}

/* ==========================================================================
   Table Responsive Styles
   ========================================================================== */

/* Stack table on very small screens */
@media (max-width: 576px) {
  .table-responsive {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .table {
    font-size: 0.875rem;
  }

  .table th,
  .table td {
    padding: 0.75rem;
    white-space: nowrap;
  }

  /* Ensure table links are tappable */
  .table a {
    display: inline-block;
    min-height: 44px;
    line-height: 44px;
    padding: 0 8px;
    margin: -8px 0;
  }

  /* Alternative: Card-style table for mobile */
  .is-mobile .table thead {
    display: none;
  }

  .is-mobile .table,
  .is-mobile .table tbody,
  .is-mobile .table tr,
  .is-mobile .table td {
    display: block;
    width: 100%;
  }

  .is-mobile .table tr {
    margin-bottom: 1rem;
    border: 1px solid #dee2e6;
    border-radius: 0.25rem;
    padding: 0.5rem;
  }

  .is-mobile .table td {
    text-align: right !important;
    padding: 0.5rem;
    position: relative;
    padding-right: 50%;
  }

  .is-mobile .table td:before {
    content: attr(data-label);
    position: absolute;
    right: 0.5rem;
    font-weight: bold;
    text-align: right;
  }

  /* Add data labels via JS or keep normal table */
  /* Comment out the card-style if you prefer horizontal scroll */
  /*
  .is-mobile .table thead {
    display: table-header-group;
  }
  .is-mobile .table,
  .is-mobile .table tbody,
  .is-mobile .table tr,
  .is-mobile .table td {
    display: table;
    display: table-row-group;
    display: table-row;
    display: table-cell;
  }
  */
}

/* ==========================================================================
   Carousel Mobile Styles
   ========================================================================== */

@media (max-width: 768px) {
  .carousel {
    margin-bottom: 1rem;
  }

  .carousel-item img {
    max-height: 50vh;
    object-fit: contain;
  }

  /* Larger carousel controls */
  .carousel-control-prev,
  .carousel-control-next {
    width: 15%;
    opacity: 0.8;
  }

  .carousel-control-prev-icon,
  .carousel-control-next-icon {
    width: 40px;
    height: 40px;
  }

  /* Swipe indicator */
  .carousel::after {
    content: "مرر لليسار أو اليمين";
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.6);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    opacity: 0;
    animation: swipeHint 2s ease-in-out 1s;
    pointer-events: none;
  }

  @keyframes swipeHint {
    0%, 100% { opacity: 0; }
    20%, 80% { opacity: 1; }
  }
}

/* ==========================================================================
   Tooltip Mobile Styles
   ========================================================================== */

@media (max-width: 768px) {
  #tooltip {
    font-size: 16px;
    padding: 8px 12px;
    max-width: 200px;
    white-space: normal;
    word-wrap: break-word;
  }

  /* Position tooltip above finger */
  .map-container:active #tooltip {
    transform: translateY(-60px);
  }
}

/* ==========================================================================
   Button and Link Mobile Styles
   ========================================================================== */

@media (max-width: 768px) {
  .btn {
    font-size: 1rem;
    padding: 0.75rem 1.5rem;
  }

  /* Full-width buttons on mobile */
  .modal-body .btn {
    width: 100%;
    margin-top: 0.5rem;
  }

  /* Stack buttons vertically */
  .modal-footer .btn {
    width: 100%;
    margin: 0.25rem 0;
  }
}

/* ==========================================================================
   Toast Mobile Styles
   ========================================================================== */

@media (max-width: 576px) {
  #toast-container {
    top: auto !important;
    bottom: 20px !important;
    right: 10px !important;
    left: 10px !important;
    padding: 0 !important;
  }

  .toast {
    width: 100%;
    margin: 0 0 0.5rem 0;
    border-radius: 0.5rem;
  }

  .toast-body {
    font-size: 1rem;
    padding: 1rem;
  }
}

/* ==========================================================================
   Loading Overlay Mobile Styles
   ========================================================================== */

@media (max-width: 768px) {
  .loading-overlay .spinner-border {
    width: 4rem !important;
    height: 4rem !important;
  }

  .loading-overlay p {
    font-size: 1.25rem;
  }
}

/* ==========================================================================
   Network Status Mobile Styles
   ========================================================================== */

@media (max-width: 768px) {
  .network-status {
    bottom: 10px;
    right: 10px;
    left: 10px;
    text-align: center;
    font-size: 0.875rem;
  }
}

/* ==========================================================================
   Landscape Orientation Adjustments
   ========================================================================== */

@media (max-width: 768px) and (orientation: landscape) {
  .map-container svg {
    max-height: 70vh;
  }

  .modal-dialog {
    max-height: 90vh;
  }

  .carousel-item img {
    max-height: 60vh;
  }
}

/* ==========================================================================
   Safe Area Insets (iPhone X, notch)
   ========================================================================== */

@supports (padding: max(0px)) {
  .modal-header,
  .modal-body,
  .modal-footer {
    padding-right: max(1rem, env(safe-area-inset-right));
    padding-left: max(1rem, env(safe-area-inset-left));
  }

  .modal-header {
    padding-top: max(1rem, env(safe-area-inset-top));
  }

  .modal-footer {
    padding-bottom: max(1rem, env(safe-area-inset-bottom));
  }

  #toast-container {
    padding-right: env(safe-area-inset-right);
    padding-left: env(safe-area-inset-left);
    padding-bottom: env(safe-area-inset-bottom);
  }
}

/* ==========================================================================
   Dark Mode Mobile Adjustments
   ========================================================================== */

/* Disabled dark mode for now to ensure readability on all devices */
/*
@media (prefers-color-scheme: dark) and (max-width: 768px) {
  .modal-content {
    background-color: #1a1a1a;
    color: #ffffff;
  }

  .table {
    color: #ffffff;
  }

  .table-striped tbody tr:nth-of-type(odd) {
    background-color: rgba(255, 255, 255, 0.05);
  }
}
*/

/* ==========================================================================
   Performance Optimizations
   ========================================================================== */

/* Hardware acceleration for animations */
.modal,
.carousel-item,
.toast {
  will-change: transform;
  transform: translateZ(0);
}

/* Reduce animations on slower devices */
@media (max-width: 768px) {
  * {
    animation-duration: 0.2s !important;
    transition-duration: 0.2s !important;
  }
}

/* ==========================================================================
   Tablet Specific Styles
   ========================================================================== */

@media (min-width: 769px) and (max-width: 1024px) {
  .map-container {
    max-width: 90%;
  }

  .modal-dialog {
    max-width: 600px;
  }

  .is-tablet .table {
    font-size: 0.95rem;
  }
}

/* ==========================================================================
   Large Mobile (Phablets)
   ========================================================================== */

@media (min-width: 577px) and (max-width: 768px) {
  .modal-dialog {
    margin: 1rem;
  }

  .modal-content {
    border-radius: 0.5rem;
  }
}

/* ==========================================================================
   Print Styles for Mobile
   ========================================================================== */

@media print {
  .modal-backdrop,
  .btn-close,
  .carousel-control-prev,
  .carousel-control-next,
  #toast-container {
    display: none !important;
  }

  .modal {
    position: static;
  }

  .modal-dialog {
    max-width: 100%;
  }
}

/* ==========================================================================
   PWA Status Bar
   ========================================================================== */

/* iOS PWA status bar */
@media (display-mode: standalone) {
  body {
    padding-top: env(safe-area-inset-top);
  }
}
